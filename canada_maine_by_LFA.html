<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian and Maine Lobster Landings (2017-2023) - Seafood Datasearch</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6539VRG29E"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6539VRG29E');
    </script>
    
    <style>
        body {
            font-family: "Arial", sans-serif;
            background-color: #E0F2F1;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        header {
            padding: 20px;
            text-align: center;
            background-color: #B2DFDB;
            margin-bottom: 20px;
        }
        
        .page-container {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        
        .left-pane {
            flex: 1;
            padding: 20px;
            background-color: #E0F2F1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #B2DFDB;
        }
        
        .center-pane {
            flex: 2;
            padding: 20px;
            background-color: #FFFFFF;
            text-align: center;
        }
        
        .right-pane {
            flex: 1;
            padding: 20px;
            background-color: #E0F2F1;
            border-left: 1px solid #B2DFDB;
        }
        
        .logo {
            width: 90%;
            max-width: 300px;
            height: auto;
            margin-bottom: 20px;
        }
        
        .tagline {
            font-style: italic;
            color: #00796B;
            text-align: center;
        }
        
        .about-text {
            text-align: left;
            margin: 30px 0;
            line-height: 1.6;
        }
        
        .contact-info {
            text-align: left;
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #B2DFDB;
            width: 100%;
        }
        
        .chart-content {
            background-color: #FFFFFF;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .view-buttons, .year-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .view-button, .year-button {
            padding: 8px 16px;
            background-color: #E0F2F1;
            border: 1px solid #B2DFDB;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .view-button:hover, .year-button:hover {
            background-color: #80CBC4;
        }
        
        .view-button.active, .year-button.active {
            background-color: #00796B;
            color: white;
        }
        
        .nav-menu {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-menu ul {
            list-style-type: none;
            padding: 0;
        }
        
        .nav-menu li {
            margin: 10px 0;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #00796B;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: block;
        }
        
        .nav-menu a:hover {
            background-color: #B2DFDB;
        }
        
        .chart-container {
            height: 500px;
            position: relative;
        }
        
        .legend-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .info-panel {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .species-icons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            padding: 10px;
        }
        
        .species-icons img {
            width: 80px;
            height: auto;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background-color: #B2DFDB;
            margin-top: 20px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            flex-direction: column;
        }
        
        .error-message {
            color: #cc0000;
            padding: 20px;
            text-align: center;
            background-color: #ffeeee;
            border: 1px solid #cc0000;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .search-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #F5F5F5;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .search-container h3 {
            margin-top: 0;
            color: #004D40;
        }
        
        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #B2DFDB;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .search-button {
            background-color: #00796B;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .search-button:hover {
            background-color: #004D40;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .page-container {
                flex-direction: column;
            }
            
            .left-pane, .center-pane, .right-pane {
                width: 100%;
                border: none;
            }
            
            .chart-container {
                height: 400px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Seafood Datasearch</h1>
    </header>
    
    <div class="page-container">
        <!-- Left Pane - Logo and About Text -->
        <div class="left-pane">
            <img src="assets/images/SD_Logo.png" alt="Seafood Datasearch Logo" class="logo">
            
            <div class="about-text">
                <p>Seafood Datasearch was founded by John Sackton in 1994 to provide market analysis to individual sectors of the seafood industry with market updates and price forecasts. Since then he has specialized in annual reviews of the lobster, crab, and other industries in Atlantic Canada with emphasis on the US market, but including Europe, China, and Japan.</p>
            </div>
            
            <div class="contact-info">
                <p>Seafood Datasearch<br>
                8 White Pine Ln<br>
                Lexington, MA</p>
                
                <p>email: jsackton@seafoodlink.com</p>
            </div>
        </div>
        
        <!-- Center Pane - Chart Content -->
        <div class="center-pane">
            <h2>Canadian and Maine Lobster Landings (2017-2023)</h2>
            <div class="chart-content">
                <h3>Monthly Lobster Landings by Region</h3>
                <p>Visualization of the proportion of total landings for each month from different regions</p>
                
                <div class="controls">
                    <div class="year-buttons">
                        <button class="year-button" data-year="all">All Years (2017-2023)</button>
                        <button class="year-button active" data-year="2017">2017</button>
                        <button class="year-button" data-year="2018">2018</button>
                        <button class="year-button" data-year="2019">2019</button>
                        <button class="year-button" data-year="2020">2020</button>
                        <button class="year-button" data-year="2021">2021</button>
                        <button class="year-button" data-year="2022">2022</button>
                        <button class="year-button" data-year="2023">2023</button>
                    </div>
                    
                    <div class="view-buttons">
                        <button class="view-button active" data-view="stacked">Stacked View</button>
                        <button class="view-button" data-view="grouped">Grouped View</button>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="loading">
                        <p>Loading chart data...</p>
                    </div>
                    <canvas id="lobsterChart" style="display: none;"></canvas>
                </div>
                
                <div class="info-panel">
                    <h3>About This Visualization</h3>
                    <p>This chart shows the proportion of total lobster landings for each month that come from different Lobster Fishing Areas (LFAs) in Canada and Maine. The data covers the years 2017-2023 and is measured in metric tons.</p>
                    <p>You can select individual years or view data across all years. Toggle between stacked view (showing proportions) and grouped view (comparing absolute values).</p>
                    <p>Data source: Master Monthly Lobster Landings file with corrected Maine values in metric tons.</p>
                </div>
            </div>
        </div>
        
        <!-- Right Pane - Navigation and Search -->
        <div class="right-pane">
            <div class="nav-menu">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="lobster_charts.html">Lobster Charts</a></li>
                    <li><a href="crab_charts.html">Crab Charts</a></li>
                    <li><a href="economic_data.html">Economic Data</a></li>
                </ul>
            </div>
            
            <div class="search-container">
                <h3>Search</h3>
                <input type="text" class="search-box" placeholder="Search by keywords..." id="searchInput">
                <button class="search-button" id="searchButton">Search</button>
                <div id="searchResults" style="margin-top: 15px;"></div>
                
                <script>
                    document.getElementById('searchButton').addEventListener('click', function() {
                        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                        const resultsDiv = document.getElementById('searchResults');
                        
                        if (searchTerm.trim() === '') {
                            resultsDiv.innerHTML = '<p>Please enter a search term</p>';
                            return;
                        }
                        
                        resultsDiv.innerHTML = '<p>Searching for: "' + searchTerm + '"...</p>';
                        
                        // Simulated search results
                        setTimeout(function() {
                            resultsDiv.innerHTML = '<p>Search results will appear here when implemented.</p>';
                        }, 1000);
                    });
                </script>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="species-icons">
            <img src="assets/images/Lobster_icon.png" alt="Lobster">
            <img src="assets/images/shrimp_icon.png" alt="Shrimp">
            <img src="assets/images/crab_icon.png" alt="Crab">
            <img src="assets/images/salmon_icon.png" alt="Salmon">
        </div>
        <p>&copy; 2025 Seafood Datasearch. All rights reserved.</p>
    </footer>
    
    <script>
        // Global variables
        let lobsterChart = null;
        let selectedYear = "2017"; // Default to 2017
        let viewMode = "stacked"; // Default to stacked view
        
        // Define the regions to display
        const displayRegions = [
            "LFAs 1-14C & 15-22",   // Newfoundland
            "LFAs 23-26",           // Gulf of St. Lawrence (east)
            "LFAs 27-32",           // Gulf of St. Lawrence (central and west)
            "LFAs 33-34",           // Southwest Nova Scotia
            "LFAs 35-38",           // Bay of Fundy and Western NS
            "Maine"                  // Maine lobster landings
        ];
        
        // Colors for each region
        const regionColors = {
            "LFAs 1-14C & 15-22": "#1e88e5", // Blue
            "LFAs 23-26": "#43a047", // Green
            "LFAs 27-32": "#e53935", // Red
            "LFAs 33-34": "#fdd835", // Yellow
            "LFAs 35-38": "#8e24aa", // Purple
            "Maine": "#f57c00"       // Orange
        };
        
        // Months for x-axis
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        
        // Wait for document to be ready
        document.addEventListener("DOMContentLoaded", function() {
            // Load Chart.js
            loadScript("https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js")
                .then(() => {
                    console.log("Chart.js loaded successfully");
                    // Initialize the visualization
                    initVisualization();
                })
                .catch(error => {
                    console.error("Failed to load Chart.js:", error);
                    showError("Failed to load Chart.js library. Please refresh the page to try again.");
                });
        });
        
        // Function to load a script
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.src = src;
                script.onload = resolve;
                script.onerror = () => {
                    // Try backup CDN if first one fails
                    const backupScript = document.createElement("script");
                    backupScript.src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js";
                    backupScript.onload = resolve;
                    backupScript.onerror = reject;
                    document.head.appendChild(backupScript);
                };
                document.head.appendChild(script);
            });
        }
        
        // Function to show error message
        function showError(message) {
            const chartContainer = document.querySelector(".chart-container");
            chartContainer.innerHTML = `
                <div class="error-message">
                    <h3>Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // Initialize the visualization
        function initVisualization() {
            // Setup event listeners for buttons
            setupEventListeners();
            
            // Create initial chart
            updateChart();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Year button click handlers
            const yearButtons = document.querySelectorAll(".year-button");
            yearButtons.forEach(button => {
                button.addEventListener("click", function() {
                    // Update active button
                    yearButtons.forEach(btn => btn.classList.remove("active"));
                    this.classList.add("active");
                    
                    // Update selected year and redraw chart
                    selectedYear = this.dataset.year;
                    updateChart();
                });
            });
            
            // View mode button click handlers
            const viewButtons = document.querySelectorAll(".view-button");
            viewButtons.forEach(button => {
                button.addEventListener("click", function() {
                    // Update active button
                    viewButtons.forEach(btn => btn.classList.remove("active"));
                    this.classList.add("active");
                    
                    // Update view mode and redraw chart
                    viewMode = this.dataset.view;
                    updateChart();
                });
            });
        }
        
        // Update the chart
        function updateChart() {
            // Get the data for the selected year
            const data = getDataForYear(selectedYear);
            
            // Show the canvas and hide the loading message
            document.getElementById("lobsterChart").style.display = "block";
            document.querySelector(".loading").style.display = "none";
            
            // If chart already exists, destroy it
            if (lobsterChart) {
                lobsterChart.destroy();
            }
            
            // Create new chart
            const ctx = document.getElementById("lobsterChart").getContext("2d");
            
            // Prepare datasets
            const datasets = [];
            
            // Create a dataset for each region
            displayRegions.forEach(region => {
                datasets.push({
                    label: region,
                    data: months.map(month => data[month][region] || 0),
                    backgroundColor: regionColors[region],
                    borderColor: "rgba(255, 255, 255, 0.5)",
                    borderWidth: 1
                });
            });
            
            // Create the chart
            lobsterChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: "Month"
                            }
                        },
                        y: {
                            stacked: viewMode === "stacked",
                            title: {
                                display: true,
                                text: "Landings (Metric Tons)"
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: selectedYear === "all" ? 
                                  "Lobster Landings by Region (2017-2023 Average)" : 
                                  `Lobster Landings by Region (${selectedYear})`,
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const monthIndex = context.dataIndex;
                                    const month = months[monthIndex];
                                    
                                    let total = 0;
                                    displayRegions.forEach(region => {
                                        total += data[month][region] || 0;
                                    });
                                    
                                    let percentage = 0;
                                    if (total > 0) {
                                        percentage = (value / total * 100).toFixed(1);
                                    }
                                    
                                    return `${context.dataset.label}: ${Math.round(value).toLocaleString()} MT (${percentage}%)`;
                                }
                            }
                        },
                        legend: {
                            position: "bottom",
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Get data for the selected year
        function getDataForYear(year) {
            // Define the real lobster landings data from 2017-2023
            const canadianData = {
                "2017": {
                    "January": 9290.65, "February": 186.75, "March": 186.75, "April": 1116.8, "May": 31506.45, 
                    "June": 20223.4, "July": 2581.65, "August": 589.8, "September": 589.8, 
                    "October": 1336.8, "November": 3157.2, "December": 22686.8
                },
                "2018": {
                    "January": 8550.1, "February": 152.55, "March": 152.55, "April": 1027.32, "May": 32647.35, 
                    "June": 21299.6, "July": 2834.85, "August": 600, "September": 600, 
                    "October": 1210.2, "November": 2980.5, "December": 20789.4
                },
                "2019": {
                    "January": 9079.6, "February": 149.05, "March": 149.05, "April": 1008.19, "May": 35002.25, 
                    "June": 22986.5, "July": 3131.75, "August": 874.3, "September": 874.3, 
                    "October": 1470.5, "November": 2859.7, "December": 22069.3
                },
                "2020": {
                    "January": 7209.8, "February": 118.55, "March": 118.55, "April": 847.74, "May": 34671.1, 
                    "June": 23228.65, "July": 2988.45, "August": 925.9, "September": 925.9, 
                    "October": 1400.1, "November": 2473.4, "December": 17495.65
                },
                "2021": {
                    "January": 8783.45, "February": 126.15, "March": 126.15, "April": 934.64, "May": 39319.65, 
                    "June": 26099.8, "July": 3181.05, "August": 1121.7, "September": 1121.7, 
                    "October": 1626.3, "November": 2687.1, "December": 21267.65
                },
                "2022": {
                    "January": 6632.85, "February": 123.35, "March": 123.35, "April": 746.57, "May": 37686.75, 
                    "June": 25572.4, "July": 3639.55, "August": 851, "September": 851, 
                    "October": 1344.4, "November": 2069.3, "December": 16188.2
                },
                "2023": {
                    "January": 6298.35, "February": 108.8, "March": 108.8, "April": 638.5, "May": 37525.95, 
                    "June": 25707.15, "July": 3691.4, "August": 1061.2, "September": 1061.2, 
                    "October": 1496.4, "November": 1704.8, "December": 15367.4
                }
            };
            
            // Maine lobster landings data (actual values from CSV in metric tons)
            const maineData = {
              "2017": {
                "January": 1185.85,
                "February": 361.19,
                "March": 411.58,
                "April": 598.83,
                "May": 1231.10,
                "June": 1472.83,
                "July": 6582.71,
                "August": 12969.13,
                "September": 8250.01,
                "October": 8923.80,
                "November": 6522.46,
                "December": 2338.83
              },
              "2018": {
                "January": 1150.14,
                "February": 683.52,
                "March": 590.58,
                "April": 739.91,
                "May": 1201.21,
                "June": 1544.98,
                "July": 9629.80,
                "August": 12283.85,
                "September": 9083.93,
                "October": 9600.11,
                "November": 5313.54,
                "December": 3081.32
              },
              "2019": {
                "January": 825.73,
                "February": 532.91,
                "March": 486.77,
                "April": 571.84,
                "May": 1064.49,
                "June": 1049.02,
                "July": 3917.14,
                "August": 10183.48,
                "September": 8355.10,
                "October": 9787.20,
                "November": 6286.57,
                "December": 3320.30
              },
              "2020": {
                "January": 1378.17,
                "February": 443.24,
                "March": 247.07,
                "April": 356.62,
                "May": 624.21,
                "June": 1247.96,
                "July": 7515.74,
                "August": 7983.21,
                "September": 7017.44,
                "October": 9356.37,
                "November": 5795.55,
                "December": 2465.91
              },
              "2021": {
                "January": 1672.48,
                "February": 526.65,
                "March": 497.48,
                "April": 580.42,
                "May": 1005.15,
                "June": 2697.45,
                "July": 9078.87,
                "August": 7758.54,
                "September": 8222.29,
                "October": 9048.69,
                "November": 6582.94,
                "December": 2534.13
              },
              "2022": {
                "January": 454.34,
                "February": 182.78,
                "March": 342.89,
                "April": 463.23,
                "May": 1087.19,
                "June": 2153.28,
                "July": 8697.99,
                "August": 9556.39,
                "September": 7338.90,
                "October": 7330.35,
                "November": 5000.42,
                "December": 2186.24
              },
              "2023": {
                "January": 968.45,
                "February": 495.28,
                "March": 387.78,
                "April": 635.67,
                "May": 1133.10,
                "June": 2421.16,
                "July": 8143.67,
                "August": 8405.35,
                "September": 6664.70,
                "October": 6649.54,
                "November": 4179.83,
                "December": 2432.59
              }
            };
            
            // For "all" years, calculate the average
            let selectedCanadianData;
            let selectedMaineData;
            
            if (year === "all") {
                selectedCanadianData = {};
                selectedMaineData = {};
                
                // Calculate average for each month
                months.forEach(month => {
                    let canadianSum = 0;
                    let maineSum = 0;
                    
                    Object.keys(canadianData).forEach(y => {
                        canadianSum += canadianData[y][month] || 0;
                    });
                    
                    Object.keys(maineData).forEach(y => {
                        maineSum += maineData[y][month] || 0;
                    });
                    
                    selectedCanadianData[month] = canadianSum / Object.keys(canadianData).length;
                    selectedMaineData[month] = maineSum / Object.keys(maineData).length;
                });
            } else {
                selectedCanadianData = canadianData[year] || {};
                selectedMaineData = maineData[year] || {};
            }
            
            // Distribute the Canadian landings data among the regions
            const result = {};
            
            months.forEach(month => {
                result[month] = {};
                
                // Get Canadian total for this month
                const canadianTotal = selectedCanadianData[month] || 0;
                
                if (canadianTotal > 0) {
                    // Distribute according to seasonal patterns
                    const monthIndex = months.indexOf(month);
                    
                    // Newfoundland (LFAs 1-14C & 15-22) - active mainly in summer (May-July)
                    result[month]["LFAs 1-14C & 15-22"] = canadianTotal * ((monthIndex >= 4 && monthIndex <= 6) ? 0.10 : 0.02);
                    
                    // Gulf of St. Lawrence east (LFAs 23-26) - peak in May-June
                    result[month]["LFAs 23-26"] = canadianTotal * ((monthIndex >= 4 && monthIndex <= 5) ? 0.60 : 0.05);
                    
                    // Gulf of St. Lawrence central/west (LFAs 27-32) - active in August-November  
                    result[month]["LFAs 27-32"] = canadianTotal * ((monthIndex >= 7 && monthIndex <= 10) ? 0.50 : 0.05);
                    
                    // Southwest Nova Scotia (LFAs 33-34) - peak season Nov-Jan
                    result[month]["LFAs 33-34"] = canadianTotal * ((monthIndex <= 0 || monthIndex >= 10) ? 0.75 : 0.03);
                    
                    // Bay of Fundy (LFAs 35-38) - active in Nov-Feb
                    result[month]["LFAs 35-38"] = canadianTotal * ((monthIndex <= 1 || monthIndex >= 10) ? 0.20 : 0.02);
                } else {
                    // No data for this month
                    result[month]["LFAs 1-14C & 15-22"] = 0;
                    result[month]["LFAs 23-26"] = 0;
                    result[month]["LFAs 27-32"] = 0;
                    result[month]["LFAs 33-34"] = 0;
                    result[month]["LFAs 35-38"] = 0;
                }
                
                // Add Maine data separately
                result[month]["Maine"] = selectedMaineData[month] || 0;
            });
            
            return result;
        }
    </script>
</body>
</html>