<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snow Crab Price Elasticity Evolution - Seafood Datasearch</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        body {
            font-family: "Arial", sans-serif;
            background-color: #E0F2F1; /* Very light sea green */
            margin: 0;
            padding: 0;
        }
        
        header {
            padding: 20px;
            text-align: center;
            background-color: #B2DFDB; /* Slightly darker sea green for header */
        }
        
        .page-container {
            display: flex;
            min-height: calc(100vh - 200px); /* Adjust based on header and footer height */
        }
        
        .left-pane {
            flex: 1;
            padding: 20px;
            background-color: #E0F2F1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #B2DFDB;
        }
        
        .center-pane {
            flex: 2;
            padding: 20px;
            background-color: #FFFFFF;
            text-align: center;
        }
        
        .right-pane {
            flex: 1;
            padding: 20px;
            background-color: #E0F2F1;
            border-left: 1px solid #B2DFDB;
        }
        
        .logo {
            width: 90%;
            max-width: 300px;
            height: auto;
            margin-bottom: 20px;
        }
        
        .tagline {
            font-style: italic;
            color: #00796B;
            text-align: center;
        }
        
        .chart-content {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-menu {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-menu ul {
            list-style-type: none;
            padding: 0;
        }
        
        .nav-menu li {
            margin: 10px 0;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #00796B;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: block;
        }
        
        .nav-menu a:hover {
            background-color: #B2DFDB;
        }
        
        .species-icons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            padding: 10px;
        }
        
        .species-icons img {
            width: 80px;
            height: auto;
        }
        
        footer {
            padding: 20px;
            background-color: #B2DFDB;
            text-align: center;
        }
        
        /* Chart container styles */
        #chart-container-wrapper {
            width: 100%;
            margin-top: 20px;
        }
        
        #chart-container {
            height: 400px;
            width: 100%;
        }
        
        /* Chart legend style */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
            gap: 15px;
            padding: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border-radius: 3px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        /* Key periods box */
        .key-periods {
            background-color: #EBF8FF;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .key-periods-title {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .key-periods ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .key-periods li {
            margin-bottom: 8px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .page-container {
                flex-direction: column;
            }
            
            .left-pane, .center-pane, .right-pane {
                width: 100%;
                border: none;
            }
            
            #chart-container {
                height: 300px;
            }
        }
    </style>
    
    <!-- Load Chart.js and PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
</head>
<body>
    <header>
        <h1>Seafood Datasearch</h1>
    </header>
    
    <div class="page-container">
        <!-- Left Pane - Logo and Tagline -->
        <div class="left-pane">
            <img src="assets/images/SD_Logo.png" alt="Seafood Datasearch Logo" class="logo">
            <div class="tagline">
                <h3>Market Analysis and Forecasts</h3>
                <p>Providing expert insights into the seafood industry.</p>
            </div>
        </div>
        
        <!-- Center Pane - Chart Content -->
        <div class="center-pane">
            <h2>Snow Crab Market Analysis</h2>
            <div class="chart-content">
                <h3>Price Elasticity Evolution (2012-2024)</h3>
                <p>Analysis of how consumer price sensitivity for snow crab has evolved over three distinct market periods.</p>
                
                <!-- Chart Container -->
                <div id="chart-container-wrapper">
                    <div class="chart-title">Snow Crab Price Elasticity Evolution (All Months)</div>
                    <div style="position: relative; height: 400px; width: 100%">
                        <canvas id="chart-container"></canvas>
                    </div>
                    <div id="chart-legend" class="chart-legend"></div>
                </div>
                
                <!-- Key Market Periods -->
                <div class="key-periods">
                    <div class="key-periods-title">Key Market Periods</div>
                    <ul>
                        <li>Low Elasticity Period (2012-2015): Average elasticity -0.0454, stable prices and consistent buyer behavior</li>
                        <li>Moderate Elasticity Period (2016-2019): Average elasticity -0.0776, increasing prices and emerging price sensitivity</li>
                        <li>High Elasticity Period (2023-2024): Average elasticity -0.2452, post-pandemic caution and heightened price sensitivity</li>
                    </ul>
                </div>
            </div>
            
            <div class="chart-content">
                <h3>About This Data</h3>
                <p>This visualization presents the relationship between snow crab retail prices and price elasticity of demand over time. Elasticity values closer to zero indicate lower price sensitivity, while more negative values show increased price sensitivity. The chart reveals how market conditions have evolved from a period of low elasticity to the current high elasticity environment.</p>
                <p>Data source: Compiled retail scanner data and market analysis (2012-2024)</p>
            </div>
        </div>
        
        <!-- Right Pane - Navigation -->
        <div class="right-pane">
            <div class="nav-menu">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="crab_charts.html">Crab Charts</a></li>
                    <li><a href="lobster_charts.html">Lobster Charts</a></li>
                    <li><a href="shrimp_charts.html">Shrimp Charts</a></li>
                    <li><a href="salmon_charts.html">Salmon Charts</a></li>
                    <li><a href="market_reports.html">Market Reports</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="species-icons">
            <img src="assets/images/Lobster_icon.png" alt="Lobster">
            <img src="assets/images/shrimp_icon.png" alt="Shrimp">
            <img src="assets/images/crab_icon.png" alt="Crab">
            <img src="assets/images/salmon_icon.png" alt="Salmon">
        </div>
        <p>&copy; 2025 Seafood Datasearch. All rights reserved.</p>
    </footer>
    
    <!-- Chart.js implementation -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Declare variables at higher scope
            let chart = null;
            
            // Check if required libraries are loaded
            if (!window.Chart || !window.Papa || !window._) {
                document.getElementById('chart-container-wrapper').innerHTML = 
                    '<div style="color: #cc0000; padding: 20px;">Error: One or more required libraries failed to load. Please check the console for details.</div>';
                console.error('Missing libraries:', {
                    'Chart.js': !!window.Chart,
                    'PapaParse': !!window.Papa,
                    'Lodash': !!window._
                });
                return;
            }
            
            // Elasticity data
            const elasticityData = [
                { year: '2012', elasticity: -0.0476, price: 4.82, period: "Low Elasticity" },
                { year: '2013', elasticity: -0.0913, price: 5.10, period: "Low Elasticity" },
                { year: '2014', elasticity: -0.0223, price: 5.27, period: "Low Elasticity" },
                { year: '2015', elasticity: -0.0202, price: 5.02, period: "Low Elasticity" },
                { year: '2016', elasticity: -0.1295, price: 6.57, period: "Moderate Elasticity" },
                { year: '2017', elasticity: -0.0833, price: 7.90, period: "Moderate Elasticity" },
                { year: '2018', elasticity: -0.0118, price: 8.58, period: "Moderate Elasticity" },
                { year: '2019', elasticity: -0.0859, price: 8.60, period: "Moderate Elasticity" },
                { year: '2023', elasticity: -0.2434, price: 5.71, period: "High Elasticity" },
                { year: '2024', elasticity: -0.2469, price: 6.42, period: "High Elasticity" }
            ];
            
            // Process the data and create chart
            createChart(elasticityData);
            
            function createChart(data) {
                const ctx = document.getElementById('chart-container').getContext('2d');
                
                // Clean up existing chart if it exists
                if (chart) {
                    chart.destroy();
                }
                
                // Define the periods with custom colors
                const periods = {
                    "Low Elasticity": "rgba(144, 238, 144, 0.2)",
                    "Moderate Elasticity": "rgba(255, 255, 224, 0.2)",
                    "High Elasticity": "rgba(255, 182, 193, 0.2)"
                };
                
                // Create the line chart with dual axes
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(item => item.year),
                        datasets: [
                            {
                                label: 'Elasticity',
                                data: data.map(item => item.elasticity),
                                borderColor: '#2563eb',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                yAxisID: 'y',
                                tension: 0.1,
                                pointRadius: 5,
                                pointHoverRadius: 7
                            },
                            {
                                label: 'Price ($/lb)',
                                data: data.map(item => item.price),
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.dataset.label || '';
                                        if (label === 'Elasticity') {
                                            return `${label}: ${context.parsed.y.toFixed(4)}`;
                                        } else {
                                            return `${label}: $${context.parsed.y.toFixed(2)}`;
                                        }
                                    },
                                    afterBody: function(context) {
                                        const index = context[0].dataIndex;
                                        return `Period: ${data[index].period}`;
                                    }
                                }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Year'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Elasticity'
                                },
                                // Invert the scale for elasticity (more negative is higher on chart)
                                reverse: true
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Price ($/lb)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    },
                    plugins: [{
                        id: 'backgroundColors',
                        beforeDraw: function(chart) {
                            if (chart.tooltip?._active?.length) return;
                            
                            const ctx = chart.ctx;
                            const chartArea = chart.chartArea;
                            const meta = chart.getDatasetMeta(0);
                            
                            // Group data by period
                            const periodGroups = _.groupBy(data, 'period');
                            
                            // Draw background color for each period
                            Object.keys(periodGroups).forEach(period => {
                                const periodData = periodGroups[period];
                                const firstIndex = data.findIndex(d => d.year === periodData[0].year);
                                const lastIndex = data.findIndex(d => d.year === periodData[periodData.length - 1].year);
                                
                                if (firstIndex >= 0 && lastIndex >= 0 && meta.data[firstIndex] && meta.data[lastIndex]) {
                                    const startX = meta.data[firstIndex].x;
                                    const endX = meta.data[lastIndex].x;
                                    
                                    ctx.fillStyle = periods[period];
                                    ctx.fillRect(
                                        startX - (meta.data[1].x - meta.data[0].x) / 2,
                                        chartArea.top,
                                        (endX - startX) + (meta.data[1].x - meta.data[0].x),
                                        chartArea.bottom - chartArea.top
                                    );
                                }
                            });
                        }
                    }]
                });
                
                // Create custom legend
                createCustomLegend();
            }
            
            function createCustomLegend() {
                const legendContainer = document.getElementById('chart-legend');
                legendContainer.innerHTML = '';
                
                // Add elasticity and price legends
                const elasticityLegend = createLegendItem('Elasticity', '#2563eb');
                const priceLegend = createLegendItem('Price ($/lb)', '#dc2626');
                
                legendContainer.appendChild(elasticityLegend);
                legendContainer.appendChild(priceLegend);
                
                // Add period legends
                const lowElasticityLegend = createLegendItem('Low Elasticity Period', 'lightgreen');
                const moderateElasticityLegend = createLegendItem('Moderate Elasticity Period', 'lightyellow');
                const highElasticityLegend = createLegendItem('High Elasticity Period', 'lightpink');
                
                legendContainer.appendChild(lowElasticityLegend);
                legendContainer.appendChild(moderateElasticityLegend);
                legendContainer.appendChild(highElasticityLegend);
            }
            
            function createLegendItem(label, color) {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.backgroundColor = color;
                
                const labelElement = document.createElement('span');
                labelElement.textContent = label;
                
                legendItem.appendChild(colorBox);
                legendItem.appendChild(labelElement);
                
                return legendItem;
            }
        });
    </script>
</body>
</html>